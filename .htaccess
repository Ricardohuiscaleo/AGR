RewriteEngine On

# =====================================================
#  RUTAS PRINCIPALES DE API (compatibilidad frontend)
# =====================================================

# Configurar rutas amigables para las APIs originales con preservaci贸n de m茅todo POST
RewriteRule ^api/generar-blog/?$ php-apis/generar-blog.php [L,QSA,P]
RewriteRule ^api/obtener-blogs/?$ php-apis/obtener-blogs.php [L,QSA]
RewriteRule ^api/buscar-blogs/?$ php-apis/buscar-blogs.php [L,QSA]
RewriteRule ^api/estadisticas/?$ php-apis/estadisticas.php [L,QSA]

# =====================================================
#  NUEVAS REDIRECCIONES DIRECTAS PARA php-apis (SIN CAMBIO DE MTODO)
# =====================================================

# Permitir acceso directo a php-apis preservando m茅todos POST
RewriteCond %{REQUEST_URI} ^/php-apis/generar-blog\.php
RewriteRule ^(.*)$ $1 [L,QSA]

RewriteCond %{REQUEST_URI} ^/php-apis/incrementar-likes\.php
RewriteRule ^(.*)$ $1 [L,QSA]

RewriteCond %{REQUEST_URI} ^/php-apis/incrementar-vistas\.php
RewriteRule ^(.*)$ $1 [L,QSA]

RewriteCond %{REQUEST_URI} ^/php-apis/obtener-completo-blog\.php
RewriteRule ^(.*)$ $1 [L,QSA]

RewriteCond %{REQUEST_URI} ^/php-apis/estadisticas\.php
RewriteRule ^(.*)$ $1 [L,QSA]

RewriteCond %{REQUEST_URI} ^/php-apis/obtener-blogs\.php
RewriteRule ^(.*)$ $1 [L,QSA]

RewriteCond %{REQUEST_URI} ^/php-apis/buscar-blogs\.php
RewriteRule ^(.*)$ $1 [L,QSA]

# =====================================================
#  NUEVAS APIS PHP (agregadas para funcionalidad completa)
# =====================================================

# API para obtener blog completo por ID
RewriteRule ^api/obtener-completo-blog/?$ php-apis/obtener-completo-blog.php [L,QSA]

# API para incrementar likes
RewriteRule ^api/incrementar-likes/?$ php-apis/incrementar-likes.php [L,QSA]

# API para incrementar vistas
RewriteRule ^api/incrementar-vistas/?$ php-apis/incrementar-vistas.php [L,QSA]

# =====================================================
#  COMPATIBILIDAD CON RUTAS FRONTEND ASTRO/TYPESCRIPT
# =====================================================

# Redirect /api/blog/obtener-generados a PHP API
RewriteRule ^api/blog/obtener-generados/?$ php-apis/obtener-blogs.php [L,QSA]

# Redirect /api/blog/buscar-por-tema a PHP API
RewriteRule ^api/blog/buscar-por-tema/?$ php-apis/buscar-blogs.php [L,QSA]

# Redirect /api/blog/estadisticas a PHP API
RewriteRule ^api/blog/estadisticas/?$ php-apis/estadisticas.php [L,QSA]

# Redirect /api/blog/generar a PHP API con preservaci贸n de POST
RewriteRule ^api/blog/generar/?$ php-apis/generar-blog.php [L,QSA,P]

# Nuevas rutas de compatibilidad para APIs adicionales
RewriteRule ^api/blog/obtener-completo/([^/]+)/?$ php-apis/obtener-completo-blog.php?id=$1 [L,QSA]
RewriteRule ^api/blog/incrementar-likes/?$ php-apis/incrementar-likes.php [L,QSA]
RewriteRule ^api/blog/incrementar-vistas/?$ php-apis/incrementar-vistas.php [L,QSA]

# =====================================================
#  BLOQUEAR ACCESO DIRECTO A ARCHIVOS DEBUG
# =====================================================
RewriteRule ^php-apis/.*-debug\.php$ - [F,L]

# Configuraci贸n de seguridad
<Files ".env">
    Order allow,deny
    Deny from all
</Files>

# Headers de seguridad
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options DENY
Header always set X-XSS-Protection "1; mode=block"

# Habilitar compresi贸n
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# Cache headers
<IfModule mod_expires.c>
    ExpiresActive on
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
</IfModule>