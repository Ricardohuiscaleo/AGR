---
// =====================================================================
// ESTE ES TU PRIMER COMPONENTE ESPECIALISTA (CORREGIDO)
// =====================================================================

// 1. Importamos el componente de React directamente, eliminando el wrapper.
import SimpleCharts from '../diagrams/SimpleCharts.jsx'; // Componente simplificado para los gráficos

// 2. DEFINIMOS LAS PROPS QUE RECIBE
interface Props {
  section: any;
}
const { section } = Astro.props;
---

<!-- 
  3. AQUÍ VA TODO EL HTML.
  Hemos eliminado `h-full` de los contenedores para que la altura se ajuste al contenido.
-->
<div class="section-inner w-full p-0 m-0 relative overflow-hidden">
  <div
    id="hola-part3-timeline"
    class="w-full relative z-10"
    style="height: 100%; position: relative;"
    data-no-reinit="true"
  >
    <div class="timeline-wrapper">
      <h2 class="text-white font-bold">Automatizamos los procesos digitales de tu empresa.</h2>
      <p class="text-white">
        Te explicamos cómo, la <span
          class="animated-gradient-text"
          style="background-image: linear-gradient(45deg, #22ff6c 0%, #43ffba 25%, #65f0ff 50%, #43ffba 75%, #22ff6c 100%); -webkit-background-clip: text; background-clip: text; color: transparent; display: inline;"
          >inteligencia artificial RAG</span
        > es el estándar <span class="low-cost-text">low-cost</span> que debes implementar en tus operaciones.
      </p>
    </div>

    <div class="container mx-auto py-6 md:py-10 px-4">
      <!-- Tarjeta destacada para el impacto económico -->
      <div
        class="bg-gradient-to-r from-amber-900/70 to-amber-700/50 rounded-xl p-5 md:p-6 shadow-xl border border-amber-500/50 mb-8 md:mb-10 backdrop-blur-sm transform hover:scale-[1.01] transition-all duration-300"
      >
        <div class="flex flex-col md:flex-row items-center gap-4">
          <div class="bg-amber-500 rounded-full p-3 md:p-4 flex items-center justify-center">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-8 w-8 md:h-10 md:w-10 text-gray-900"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              ></path>
            </svg>
          </div>
          <div class="flex-1 text-center md:text-left">
            <h2 class="text-2xl md:text-3xl font-bold mb-2 text-white">
              Impacto Económico de Agentes IA RAG
            </h2>
            <p class="text-base md:text-lg text-white font-bold">
              Análisis comparativo de los costos operativos antes y después de implementar agentes
              IA RAG en una empresa con ventas de <span class="text-amber-300 font-bold"
                >$10.000.000 CLP mensuales</span
              >.
            </p>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-12 mb-12 md:mb-16">
        <!-- Gráfico 1: Comparación de costos operativos -->
        <div class="bg-gray-900 rounded-xl p-4 md:p-6 shadow-lg border border-amber-900/30">
          <h2 class="text-xl md:text-2xl font-bold mb-3 md:mb-4 text-amber-400">
            Comparación de Costos Operativos
          </h2>
          <div id="cost-comparison-container" class="h-64 md:h-80 relative mb-4 md:mb-6">
            <!-- El gráfico se inyectará aquí mediante React -->
          </div>
          <div class="grid grid-cols-2 gap-3 md:gap-4 text-center text-xs md:text-sm mt-4 md:mt-6">
            <div class="bg-black/20 p-3 md:p-4 rounded-lg">
              <span class="block text-xl md:text-2xl font-bold text-red-400">$3.600.000</span>
              <span class="text-white font-bold">Costos con Modelo Tradicional</span>
            </div>
            <div class="bg-black/20 p-3 md:p-4 rounded-lg">
              <span class="block text-xl md:text-2xl font-bold text-green-400">$1.980.000</span>
              <span class="text-white font-bold">Costos con Agentes IA RAG</span>
            </div>
          </div>
          <div class="mt-4">
            <p class="text-green-400 text-base md:text-lg font-bold text-center">
              Ahorro mensual: $1.620.000 (45%)
            </p>
          </div>
        </div>

        <!-- Gráfico 2: Distribución de costos antes y después -->
        <div class="bg-gray-900 rounded-xl p-4 md:p-6 shadow-lg border border-amber-900/30">
          <h2 class="text-xl md:text-2xl font-bold mb-3 md:mb-4 text-amber-400">
            Comparación de Distribución de Costos
          </h2>
          <div id="pie-charts-container" class="h-[500px] md:h-[480px] lg:h-[440px] relative">
            <!-- Los gráficos de pastel se inyectarán aquí mediante React -->
          </div>
          <div class="bg-black/20 p-3 md:p-4 rounded-lg text-xs md:text-sm mt-4 md:mt-6">
            <p class="mb-2 text-white font-bold">
              La implementación de agentes IA RAG reduce significativamente los costos de personal,
              atención al cliente y procesamiento de datos, manteniendo o mejorando la calidad del
              servicio.
            </p>
            <ul class="list-disc list-inside space-y-1 text-white font-bold">
              <li>
                <span class="text-amber-400">Personal:</span> Automatización de tareas repetitivas
              </li>
              <li>
                <span class="text-amber-400">Atención al cliente:</span> Disponibilidad 24/7 sin costos
                extras
              </li>
              <li>
                <span class="text-amber-400">Errores operativos:</span> Reducción del 85% en errores
                de procesamiento
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8 mb-12 md:mb-16">
        <!-- Gráfico 3: Retorno de inversión -->
        <div class="bg-gray-900 rounded-xl p-4 md:p-6 shadow-lg border border-amber-900/30">
          <h2 class="text-xl md:text-2xl font-bold mb-3 md:mb-4 text-amber-400">
            Retorno de Inversión
          </h2>
          <div id="roi-chart-container" class="h-56 md:h-64 relative">
            <!-- El gráfico ROI se inyectará aquí mediante React -->
          </div>
          <div class="mt-4 bg-black/20 p-3 md:p-4 rounded-lg text-xs md:text-sm">
            <p class="text-white font-bold">
              La inversión inicial en agentes IA RAG se recupera en promedio en <span
                class="text-amber-400 font-bold text-sm md:text-base">5 meses</span
              >, con beneficios crecientes a medida que el sistema se optimiza.
            </p>
          </div>
        </div>

        <!-- Gráfico 4: Eficiencia operativa -->
        <div class="bg-gray-900 rounded-xl p-4 md:p-6 shadow-lg border border-amber-900/30">
          <h2 class="text-xl md:text-2xl font-bold mb-3 md:mb-4 text-amber-400">
            Eficiencia Operativa
          </h2>
          <div id="efficiency-chart-container" class="h-56 md:h-64 relative">
            <!-- El gráfico de eficiencia se inyectará aquí mediante React -->
          </div>
          <div class="mt-4 bg-black/20 p-3 md:p-4 rounded-lg text-xs md:text-sm">
            <p class="text-white font-bold">
              Los agentes IA RAG mejoran los tiempos de respuesta en un <span
                class="text-amber-400 font-bold text-sm md:text-base">75%</span
              > y aumentan la capacidad de procesamiento de consultas en un <span
                class="text-amber-400 font-bold text-sm md:text-base">300%</span
              >.
            </p>
          </div>
        </div>

        <!-- Gráfico 5: Impacto en resultados financieros -->
        <div class="bg-gray-900 rounded-xl p-4 md:p-6 shadow-lg border border-amber-900/30">
          <h2 class="text-xl md:text-2xl font-bold mb-3 md:mb-4 text-amber-400">
            Impacto en Resultados
          </h2>
          <div id="financial-chart-container" class="h-56 md:h-64 relative">
            <!-- El gráfico financiero se inyectará aquí mediante React -->
          </div>
          <div class="mt-4 bg-black/20 p-3 md:p-4 rounded-lg text-xs md:text-sm">
            <p class="text-white font-bold">
              Con el ahorro mensual de <span class="text-amber-400 font-bold text-sm md:text-base"
                >$1.620.000</span
              >, el margen de beneficio aumenta del <span
                class="text-amber-400 font-bold text-sm md:text-base">20%</span
              > al <span class="text-amber-400 font-bold text-sm md:text-base">36%</span> sobre las ventas
              mensuales.
            </p>
          </div>
        </div>
      </div>

      <div
        class="bg-gray-900 rounded-xl p-4 md:p-8 shadow-lg border border-amber-900/30 mb-8 md:mb-16 overflow-hidden"
      >
        <h2 class="text-xl md:text-2xl font-bold mb-4 md:mb-6 text-amber-400">
          Desglose de Costos Mensuales (CLP)
        </h2>
        <div class="overflow-x-auto -mx-4 md:mx-0">
          <div class="min-w-[600px] px-4 md:px-0 md:min-w-full">
            <table class="w-full text-white font-bold text-xs md:text-base">
              <thead>
                <tr class="border-b border-gray-700">
                  <th class="py-2 md:py-3 text-left text-white font-bold">Categoría</th>
                  <th class="py-2 md:py-3 text-right text-white font-bold">Modelo Tradicional</th>
                  <th class="py-2 md:py-3 text-right text-white font-bold">Con Agentes IA RAG</th>
                  <th class="py-2 md:py-3 text-right text-white font-bold">Ahorro</th>
                  <th class="py-2 md:py-3 text-right text-white font-bold">Reducción %</th>
                </tr>
              </thead>
              <tbody>
                <tr class="border-b border-gray-800">
                  <td class="py-2 md:py-3 text-white font-bold">Personal de atención al cliente</td>
                  <td class="py-2 md:py-3 text-right text-white font-bold">$1.200.000</td>
                  <td class="py-2 md:py-3 text-right text-white font-bold">$480.000</td>
                  <td class="py-2 md:py-3 text-right text-green-400 font-bold">$720.000</td>
                  <td class="py-2 md:py-3 text-right text-green-400 font-bold">60%</td>
                </tr>
                <tr class="border-b border-gray-800">
                  <td class="py-2 md:py-3 text-white font-bold">Procesamiento de documentos</td>
                  <td class="py-2 md:py-3 text-right text-white font-bold">$850.000</td>
                  <td class="py-2 md:py-3 text-right text-white font-bold">$340.000</td>
                  <td class="py-2 md:py-3 text-right text-green-400 font-bold">$510.000</td>
                  <td class="py-2 md:py-3 text-right text-green-400 font-bold">60%</td>
                </tr>
                <tr class="border-b border-gray-800">
                  <td class="py-2 md:py-3 text-white font-bold">Infraestructura tecnológica</td>
                  <td class="py-2 md:py-3 text-right text-white font-bold">$450.000</td>
                  <td class="py-2 md:py-3 text-right text-white font-bold">$380.000</td>
                  <td class="py-2 md:py-3 text-right text-green-400 font-bold">$70.000</td>
                  <td class="py-2 md:py-3 text-right text-green-400 font-bold">15%</td>
                </tr>
                <tr class="border-b border-gray-800">
                  <td class="py-2 md:py-3 text-white font-bold">Corrección de errores</td>
                  <td class="py-2 md:py-3 text-right text-white font-bold">$350.000</td>
                  <td class="py-2 md:py-3 text-right text-white font-bold">$70.000</td>
                  <td class="py-2 md:py-3 text-right text-green-400 font-bold">$280.000</td>
                  <td class="py-2 md:py-3 text-right text-green-400 font-bold">80%</td>
                </tr>
                <tr class="border-b border-gray-800">
                  <td class="py-2 md:py-3 text-white font-bold">Capacitación</td>
                  <td class="py-2 md:py-3 text-right text-white font-bold">$220.000</td>
                  <td class="py-2 md:py-3 text-right text-white font-bold">$180.000</td>
                  <td class="py-2 md:py-3 text-right text-green-400 font-bold">$40.000</td>
                  <td class="py-2 md:py-3 text-right text-green-400 font-bold">18%</td>
                </tr>
                <tr class="border-b border-gray-800">
                  <td class="py-2 md:py-3 text-white font-bold">Software y licencias</td>
                  <td class="py-2 md:py-3 text-right text-white font-bold">$380.000</td>
                  <td class="py-2 md:py-3 text-right text-white font-bold">$480.000</td>
                  <td class="py-2 md:py-3 text-right text-red-400 font-bold">-$100.000</td>
                  <td class="py-2 md:py-3 text-right text-red-400 font-bold">-26%</td>
                </tr>
                <tr class="border-b border-gray-800">
                  <td class="py-2 md:py-3 text-white font-bold">Horas extras</td>
                  <td class="py-2 md:py-3 text-right text-white font-bold">$150.000</td>
                  <td class="py-2 md:py-3 text-right text-white font-bold">$50.000</td>
                  <td class="py-2 md:py-3 text-right text-green-400 font-bold">$100.000</td>
                  <td class="py-2 md:py-3 text-right text-green-400 font-bold">67%</td>
                </tr>
                <tr class="font-bold">
                  <td class="py-2 md:py-3 text-white font-bold">TOTAL</td>
                  <td class="py-2 md:py-3 text-right text-white font-bold">$3.600.000</td>
                  <td class="py-2 md:py-3 text-right text-white font-bold">$1.980.000</td>
                  <td class="py-2 md:py-3 text-right text-green-400 font-bold">$1.620.000</td>
                  <td class="py-2 md:py-3 text-right text-green-400 font-bold">45%</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div
        class="bg-gray-900 rounded-xl p-4 md:p-8 shadow-lg border border-amber-900/30 mb-8 md:mb-16 overflow-hidden"
      >
        <h2 class="text-xl md:text-2xl font-bold mb-4 md:mb-6 text-amber-400">
          5 Áreas Principales de Ahorro
        </h2>
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3 md:gap-6 mb-4 md:mb-6">
          <div class="bg-black/20 p-3 md:p-4 rounded-lg text-center">
            <div class="text-xl md:text-3xl font-bold text-amber-400 mb-1 md:mb-2">60%</div>
            <h3 class="text-sm md:text-base text-white font-bold mb-1 md:mb-2">Personal</h3>
            <p class="text-xs md:text-sm text-white font-bold">
              Reducción de personal para tareas repetitivas y básicas
            </p>
          </div>
          <div class="bg-black/20 p-3 md:p-4 rounded-lg text-center">
            <div class="text-xl md:text-3xl font-bold text-amber-400 mb-1 md:mb-2">80%</div>
            <h3 class="text-sm md:text-base text-white font-bold mb-1 md:mb-2">Errores</h3>
            <p class="text-xs md:text-sm text-white font-bold">
              Menor costo en corrección de errores operativos
            </p>
          </div>
          <div class="bg-black/20 p-3 md:p-4 rounded-lg text-center">
            <div class="text-xl md:text-3xl font-bold text-amber-400 mb-1 md:mb-2">67%</div>
            <h3 class="text-sm md:text-base text-white font-bold mb-1 md:mb-2">Horas extras</h3>
            <p class="text-xs md:text-sm text-white font-bold">
              Reducción en pagos de horas extras
            </p>
          </div>
          <div class="bg-black/20 p-3 md:p-4 rounded-lg text-center">
            <div class="text-xl md:text-3xl font-bold text-amber-400 mb-1 md:mb-2">75%</div>
            <h3 class="text-sm md:text-base text-white font-bold mb-1 md:mb-2">Tiempo</h3>
            <p class="text-xs md:text-sm text-white font-bold">
              Reducción en tiempos de procesamiento
            </p>
          </div>
          <div class="bg-black/20 p-3 md:p-4 rounded-lg text-center col-span-2 sm:col-span-1">
            <div class="text-xl md:text-3xl font-bold text-amber-400 mb-1 md:mb-2">24/7</div>
            <h3 class="text-sm md:text-base text-white font-bold mb-1 md:mb-2">Disponibilidad</h3>
            <p class="text-xs md:text-sm text-white font-bold">
              Atención continua sin costos adicionales
            </p>
          </div>
        </div>
        <div class="bg-amber-900/20 p-3 md:p-4 rounded-lg">
          <p class="text-white font-bold text-center text-sm md:text-base">
            <span class="font-bold text-amber-400">Resultado final:</span> Por cada $10.000.000 en ventas,
            los agentes IA RAG permiten un ahorro de <span
              class="font-bold text-amber-400 text-sm md:text-base">$1.620.000</span
            > mensuales, lo que equivale a <span
              class="font-bold text-amber-400 text-sm md:text-base">$19.440.000</span
            >
            anuales.
          </p>
        </div>
      </div>

      <!-- BOTÓN DEL CHAT INCRUSTADO DIRECTAMENTE -->
      <div class="w-full flex justify-center my-12 md:my-16">
        <button
          id="hola-chat-button"
          class="chat-toggle-button"
          aria-label="Abrir chat comercial"
          title="Hablar con Gaby"
        >
          <div class="chat-icon-wrapper">
            <svg
              class="chat-icon-svg"
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
          </div>
          <div class="chat-text-container">
            <span id="chat-dynamic-phrase" class="chat-dynamic-phrase"
              >¡Hola! Pregúntame algo...</span
            >
          </div>
        </button>
      </div>

      <!-- Incluimos el componente SimpleCharts para que se cargue el componente React -->
      <SimpleCharts client:load />
    </div>
  </div>
</div>

<!-- SCRIPT DEL BOTÓN DEL CHAT INCRUSTADO DIRECTAMENTE -->
<script>
  declare global {
    interface DocumentEventMap {
      chatStatusUpdate: CustomEvent<{ phrase: string }>;
      openChatModal: CustomEvent;
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    const chatToggleButton = document.getElementById('hola-chat-button');
    const chatDynamicPhrase = document.getElementById('chat-dynamic-phrase');

    if (chatToggleButton && chatDynamicPhrase) {
      chatToggleButton.addEventListener('click', () => {
        document.dispatchEvent(new CustomEvent('openChatModal', {
          detail: { buttonId: 'hola-chat-button' }
        }));
      });

      document.addEventListener('chatStatusUpdate', (event) => {
        if (event.detail && event.detail.phrase) {
          chatDynamicPhrase.textContent = event.detail.phrase;
        }
      });

      const phrases = [
        'Estoy para ayudarte',
        '¿Hablamos de costos?',
        'Automatiza tu negocio',
        'Consulta sobre IA RAG',
        'Agenda una reunión aquí',
        '¿Tienes alguna duda?',
      ];
      let currentPhraseIndex = 0;

      const updatePhrase = () => {
        if (!chatDynamicPhrase) return;
        chatDynamicPhrase.classList.add('phrase-fade-out');
        setTimeout(() => {
          currentPhraseIndex = (currentPhraseIndex + 1) % phrases.length;
          chatDynamicPhrase.textContent = phrases[currentPhraseIndex];
          chatDynamicPhrase.classList.remove('phrase-fade-out');
        }, 300);
      };
      setInterval(updatePhrase, 5000);
    }
  });
</script>

<!-- ESTILOS DEL BOTÓN DEL CHAT INCRUSTADOS DIRECTAMENTE -->
<style>
  .chat-toggle-button {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 12px 24px;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    color: white;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    background: linear-gradient(110deg, #7c3aed 0%, #a855f7 50%, #7c3aed 100%);
    background-size: 200% 100%;
    box-shadow:
      0 0 20px rgba(124, 58, 237, 0.4),
      0 4px 10px rgba(0, 0, 0, 0.2);
    transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    user-select: none;
  }
  .chat-toggle-button:hover {
    background-position: right center;
    transform: translateY(-3px) scale(1.03);
    box-shadow:
      0 0 30px rgba(168, 85, 247, 0.6),
      0 8px 15px rgba(0, 0, 0, 0.3);
  }
  .chat-toggle-button:active {
    transform: translateY(-1px) scale(1);
  }
  .chat-icon-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .chat-icon-svg {
    transition: transform 0.3s ease;
  }
  .chat-toggle-button:hover .chat-icon-svg {
    transform: rotate(-15deg) scale(1.1);
  }
  .chat-text-container {
    position: relative;
    height: 1.2em;
  }
  .chat-dynamic-phrase {
    display: inline-block;
    white-space: nowrap;
    transition:
      opacity 0.3s ease-in-out,
      transform 0.3s ease-in-out;
    opacity: 1;
    transform: translateY(0);
  }
  .chat-dynamic-phrase.phrase-fade-out {
    opacity: 0;
    transform: translateY(-10px);
  }
</style>

<!-- Script para optimizar el rendimiento de los gráficos -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Añadir estilos para optimizar el rendimiento
    const style = document.createElement('style');
    style.textContent = `
      [id$="-container"] {
        transform: translateZ(0);
        will-change: transform;
      }
    `;
    document.head.appendChild(style);
    
    // Marcar los contenedores para evitar reinicializaciones
    const chartContainers = document.querySelectorAll('[id$="-container"]');
    chartContainers.forEach(container => {
      container.classList.add('chart-container');
    });
  });
</script>
